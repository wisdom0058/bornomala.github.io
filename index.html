<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content" />
  <title>‡¶¨‡¶∞‡ßç‡¶£‡¶Æ‡¶æ‡¶≤‡¶æ ‡¶∞‡¶æ‡¶á‡¶ü‡¶æ‡¶∞</title>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    :root {
      --vh: 1vh; /* mobile fullscreen helper [web:256][web:266] */
    }
    body {
      margin: 0;
      font-family: "Noto Sans Bengali", system-ui, sans-serif;
      background:#eef2ff;
      color:#111827;
    }
    .app {
      display:flex;
      height: calc(var(--vh) * 100);
      max-width:1200px;
      margin:0 auto;
      padding:8px;
      gap:8px;
    }
    @media (max-width:768px){
      .app { flex-direction:row; padding:4px; }
    }
    .left-panel {
      flex:4;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .board {
      min-height:40vh;
      background:#ffffff;
      border-radius:18px;
      box-shadow:0 0 8px rgba(0,0,0,0.08);
      padding:16px;
      font-size:56px;
      line-height:1.5;
      overflow-y:auto;
    }
    .board:focus { outline:3px solid #6366f1; }
    @media (max-width:768px){
      .board { font-size:40px; min-height:32vh; }
    }
    .toggle-row {
      display:flex;
      gap:6px;
    }
    .toggle-btn {
      flex:1;
      padding:6px 4px;
      border-radius:999px;
      border:none;
      font-size:14px;
      cursor:pointer;
      background:#e5e7eb;
      color:#111827;
    }
    .toggle-btn.active {
      background:#6366f1;
      color:#ffffff;
    }
    .keys-container {
      background:#ffffff;
      border-radius:18px;
      box-shadow:0 0 8px rgba(0,0,0,0.08);
      padding:10px;
      max-height:40vh;
      overflow-y:auto;
    }
    .keys-area {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(52px,1fr));
      gap:8px;
    }
    .key {
      border:none;
      border-radius:999px;
      background:#f97316;
      color:#ffffff;
      font-size:26px;
      cursor:pointer;
      padding:10px 0;
      text-align:center;
      transition:transform 0.05s ease;
    }
    .key:active { transform:scale(0.95); }
    .key.vowel { background:#22c55e; }
    .key.kar   { background:#0ea5e9; }

    .right-panel {
      flex:1.3;
      display:flex;
      flex-direction:column;
      align-items:stretch;
      gap:8px;
    }
    .tool-btn {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:8px;
      border-radius:16px;
      border:none;
      cursor:pointer;
      color:#111827;
      background:#ffffff;
      box-shadow:0 0 6px rgba(0,0,0,0.08);
      font-size:11px;
      text-align:center;
      min-height:58px;
    }
    .tool-icon {
      font-size:20px;
      margin-bottom:4px;
    }
    .tool-join       { border-left:4px solid #a855f7; }
    .tool-space      { border-left:4px solid #22c55e; }
    .tool-back       { border-left:4px solid #f97316; }
    .tool-clear      { border-left:4px solid #ef4444; }
    .tool-speak      { border-left:4px solid #3b82f6; }
    .tool-copy       { border-left:4px solid #6b7280; }
    .tool-end        { border-left:4px solid #0d9488; }
    .tool-translate  { border-left:4px solid #10b981; }
    .tool-voice      { border-left:4px solid #facc15; }

    .info-box {
      margin-top:4px;
      font-size:11px;
      background:#e5e7eb;
      border-radius:10px;
      padding:6px;
      line-height:1.4;
    }
    .muted { opacity:0.5; cursor:not-allowed; }
  </style>
</head>
<body>

<div class="app">
  <div class="left-panel">
    <div class="board" id="board" contenteditable="true"></div>

    <div class="toggle-row">
      <button class="toggle-btn active" data-tab="benjon">‡¶¨‡ßç‡¶Ø‡¶û‡ßç‡¶ú‡¶®‡¶¨‡¶∞‡ßç‡¶£</button>
      <button class="toggle-btn" data-tab="swar">‡¶∏‡ßç‡¶¨‡¶∞‡¶¨‡¶∞‡ßç‡¶£</button>
      <button class="toggle-btn" data-tab="kar">‡¶∏‡ßç‡¶¨‡¶∞‡¶ö‡¶ø‡¶π‡ßç‡¶®/‡ßç</button>
    </div>

    <div class="keys-container">
      <div class="keys-area" id="keysArea"></div>
    </div>
  </div>

  <div class="right-panel">
    <button class="tool-btn tool-join" id="joinBtn">
      <div class="tool-icon">‚áÑ</div>‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶æ‡¶ï‡ßç‡¶∑‡¶∞
    </button>
    <button class="tool-btn tool-end" id="endSentenceBtn">
      <div class="tool-icon">‡•§</div>‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø ‡¶∂‡ßá‡¶∑
    </button>
    <button class="tool-btn tool-space" id="spaceBtn">
      <div class="tool-icon">‚ê£</div>‡¶´‡¶æ‡¶Å‡¶ï
    </button>
    <button class="tool-btn tool-back" id="backBtn">
      <div class="tool-icon">‚å´</div>‡¶è‡¶ï‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßã
    </button>
    <button class="tool-btn tool-clear" id="clearBtn">
      <div class="tool-icon">‚úï</div>‡¶∏‡¶¨ ‡¶Æ‡ßÅ‡¶õ‡ßã
    </button>
    <button class="tool-btn tool-speak" id="speakBtn">
      <div class="tool-icon">üîä</div>‡¶∂‡ßÅ‡¶®‡ßã
    </button>
    <button class="tool-btn tool-copy" id="copyBtn">
      <div class="tool-icon">üìã</div>‡¶ï‡¶™‡¶ø
    </button>
    <button class="tool-btn tool-translate" id="translateBtn">
      <div class="tool-icon">üàØ</div>‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶
    </button>
    <button class="tool-btn tool-voice" id="voiceBtn">
      <div class="tool-icon">üé§</div>‡¶ï‡¶•‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßã
    </button>

    <div class="info-box" id="infoBox">
      ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßá ‚Äú‡¶∂‡ßÅ‡¶®‡ßã‚Äù ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∂‡ßã‡¶®‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá, ‚Äú‡¶ï‡¶•‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßã‚Äù ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡¶≤‡ßá (‡¶Ø‡¶¶‡¶ø ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶® ‡¶ï‡¶∞‡ßá) ‡¶Æ‡ßÅ‡¶ñ‡ßá ‡¶¨‡¶≤‡¶æ ‡¶ï‡¶•‡¶æ ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶π‡¶¨‡ßá‡•§
    </div>
  </div>
</div>

<script>
  // mobile fullscreen fix: set --vh based on innerHeight [web:256][web:266]
  function updateVh() {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty("--vh", vh + "px");
  }
  window.addEventListener("resize", updateVh);
  updateVh();

  // ‡¶¨‡ßç‡¶Ø‡¶û‡ßç‡¶ú‡¶®‡¶¨‡¶∞‡ßç‡¶£ + ‡¶∂‡ßá‡¶∑ ‡¶ö‡¶æ‡¶∞‡¶ü‡¶ø ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶≤‡¶æ‡¶á‡¶®‡ßá [web:220][web:223]
  const benjonborno = [
    "‡¶ï","‡¶ñ","‡¶ó","‡¶ò","‡¶ô",
    "‡¶ö","‡¶õ","‡¶ú","‡¶ù","‡¶û",
    "‡¶ü","‡¶†","‡¶°","‡¶¢","‡¶£",
    "‡¶§","‡¶•","‡¶¶","‡¶ß","‡¶®",
    "‡¶™","‡¶´","‡¶¨","‡¶≠","‡¶Æ",
    "‡¶Ø","‡¶∞","‡¶≤","‡¶∂","‡¶∑","‡¶∏","‡¶π",
    "‡¶°‡¶º","‡¶¢‡¶º","‡¶Ø‡¶º",
    "‡¶Ç","‡¶Å","‡¶É","‡ßé"
  ];

  const swarborno = ["‡¶Ö","‡¶Ü","‡¶á","‡¶à","‡¶â","‡¶ä","‡¶ã","‡¶è","‡¶ê","‡¶ì","‡¶î"];

  const VIRAMA = "‡ßç";  // Bengali virama [web:81][web:215]

  const karSigns = [
    {label:"‡¶æ", apply:"‡¶æ"},
    {label:"‡¶ø", apply:"‡¶ø"},
    {label:"‡ßÄ", apply:"‡ßÄ"},
    {label:"‡ßÅ", apply:"‡ßÅ"},
    {label:"‡ßÇ", apply:"‡ßÇ"},
    {label:"‡ßÉ", apply:"‡ßÉ"},
    {label:"‡ßá", apply:"‡ßá"},
    {label:"‡ßà", apply:"‡ßà"},
    {label:"‡ßã", apply:"‡ßã"},
    {label:"‡ßå", apply:"‡ßå"},
    {label:"‡ßç", apply:VIRAMA}
  ];

  const board      = document.getElementById("board");
  const keysArea   = document.getElementById("keysArea");
  const toggleBtns = document.querySelectorAll(".toggle-btn");
  const infoBox    = document.getElementById("infoBox");
  const speakBtn   = document.getElementById("speakBtn");
  const translateBtn = document.getElementById("translateBtn");
  const voiceBtn   = document.getElementById("voiceBtn");

  const defaultInfoMessage =
    "‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßá ‚Äú‡¶∂‡ßÅ‡¶®‡ßã‚Äù ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∂‡ßã‡¶®‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá, ‚Äú‡¶ï‡¶•‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßã‚Äù ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡¶≤‡ßá (‡¶Ø‡¶¶‡¶ø ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶® ‡¶ï‡¶∞‡ßá) ‡¶Æ‡ßÅ‡¶ñ‡ßá ‡¶¨‡¶≤‡¶æ ‡¶ï‡¶•‡¶æ ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶π‡¶¨‡ßá‡•§";

  function focusBoard() {
    if (document.activeElement !== board) board.focus();
  }

  function insertAtCursor(text) {
    focusBoard();
    let ok = false;
    try {
      ok = document.execCommand("insertText", false, text);  // Unicode insert [web:120]
    } catch(e) { ok = false; }
    if (!ok) {
      board.textContent += text;
      placeCaretAtEnd();
    }
  }

  function placeCaretAtEnd() {
    focusBoard();
    const range = document.createRange();
    range.selectNodeContents(board);
    range.collapse(false);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
  }

  function addConsonant(ch){ insertAtCursor(ch); }
  function addPlain(ch){ insertAtCursor(ch); }
  function applyKar(kar){ insertAtCursor(kar); }

  function makeJuktakkhor() {
    const text = board.textContent;
    if (text.length < 2) return;
    const before = text.slice(0,-2);
    const last2  = text.slice(-2);
    const joined = last2[0] + VIRAMA + last2[1];
    board.textContent = before + joined;
    placeCaretAtEnd();
  }

  function buildKeys(tab){
    keysArea.innerHTML = "";
    const addButton = (ch, cls, handler) => {
      const b = document.createElement("button");
      b.className = "key " + cls;
      b.textContent = ch;
      b.onclick = () => handler(ch);
      keysArea.appendChild(b);
    };
    if(tab === "benjon"){
      benjonborno.forEach(ch => addButton(ch,"",addConsonant));
    } else if(tab === "swar"){
      swarborno.forEach(ch => addButton(ch,"vowel",addPlain));
    } else {
      karSigns.forEach(k => addButton(k.label,"kar",() => applyKar(k.apply)));
    }
  }

  toggleBtns.forEach(btn=>{
    btn.addEventListener("click",()=>{
      toggleBtns.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      buildKeys(btn.dataset.tab);
    });
  });

  document.getElementById("joinBtn").onclick = makeJuktakkhor;
  document.getElementById("spaceBtn").onclick = () => insertAtCursor(" ");
  document.getElementById("endSentenceBtn").onclick = () => {
    const t = board.textContent.replace(/\s+$/g,"");
    board.textContent = t + "‡•§ ";
    placeCaretAtEnd();
  };
  document.getElementById("backBtn").onclick = () => {
    const t = board.textContent;
    if (!t) return;
    board.textContent = t.slice(0,-1);
    placeCaretAtEnd();
  };
  document.getElementById("clearBtn").onclick = () => {
    board.textContent = "";
    placeCaretAtEnd();
  };
  document.getElementById("copyBtn").onclick = async () => {
    if (!navigator.clipboard) { alert("‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º‡•§"); return; }
    try{
      await navigator.clipboard.writeText(board.textContent);
      infoBox.textContent = "‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§";
      setTimeout(()=>infoBox.textContent=defaultInfoMessage,2000);
    }catch(e){
      alert("‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§");
    }
  };

  // ----- Bangla TTS -----
  function setupVoicesNotice(){
    if (!("speechSynthesis" in window)){
      infoBox.textContent = "‡¶è‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü‚Äë‡¶ü‡ßÅ‚Äë‡¶∏‡ßç‡¶™‡¶ø‡¶ö ‡¶®‡ßá‡¶á‡•§";
      speakBtn.classList.add("muted");
      return;
    }
    function checkVoices(){
      const voices = window.speechSynthesis.getVoices();
      const hasBn = voices.some(v=>v.lang && v.lang.toLowerCase().startsWith("bn"));
      infoBox.textContent = hasBn ? defaultInfoMessage :
        "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶®‡ßá‡¶á; ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§";
    }
    window.speechSynthesis.onvoiceschanged = checkVoices;
    checkVoices();
  }

  function speakBangla(text){
    if (!("speechSynthesis" in window)) return;
    const t = text.trim();
    if (!t) return;
    const utt = new SpeechSynthesisUtterance(t);
    utt.lang = "bn-IN";
    const vs = window.speechSynthesis.getVoices();
    const bn = vs.find(v=>v.lang && v.lang.toLowerCase().startsWith("bn"));
    if (bn) utt.voice = bn;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utt);
  }

  speakBtn.onclick = () => {
    const t = board.textContent;
    if (!t.trim()) return;
    speakBangla(t);
  };

  // ----- Google Translate in new tab [web:157][web:161] -----
  function openGoogleTranslate(text){
    const q = text.trim();
    if (!q) return;
    const url =
      "https://translate.google.com/?sl=bn&tl=en&text=" +
      encodeURIComponent(q) +
      "&op=translate";
    window.open(url, "_blank");
  }

  translateBtn.onclick = () => {
    const bn = board.textContent;
    if (!bn.trim()) return;
    openGoogleTranslate(bn);
  };

  // ----- Voice input with Web Speech API, fallback message on mobile [web:231][web:253] -----
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition || null;

  let recognition = null;
  let isListening = false;

  if (!SpeechRecognition) {
    voiceBtn.classList.add("muted");
    voiceBtn.disabled = true;
    voiceBtn.title = "‡¶è‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶® ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ (‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ Chrome ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®)‡•§";
  } else {
    recognition = new SpeechRecognition();
    recognition.lang = "bn-IN";
    recognition.continuous = false;
    recognition.interimResults = false;

    recognition.addEventListener("result", (event) => {
      const transcript = event.results[0][0].transcript;
      insertAtCursor(transcript + " ");
    });

    recognition.addEventListener("error", () => {
      infoBox.textContent = "‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá; ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ï‡ßÄ‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã‡•§";
      setTimeout(()=>infoBox.textContent = defaultInfoMessage, 4000);
    });

    recognition.addEventListener("end", () => {
      isListening = false;
      voiceBtn.innerHTML = '<div class="tool-icon">üé§</div>‡¶ï‡¶•‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßã';
    });

    voiceBtn.onclick = () => {
      if (!recognition) return;
      if (!isListening) {
        isListening = true;
        voiceBtn.innerHTML = '<div class="tool-icon">‚èπ</div>‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßã';
        recognition.start();  // mic permission prompt
      } else {
        recognition.stop();
      }
    };
  }

  buildKeys("benjon");
  setupVoicesNotice();
  placeCaretAtEnd();
</script>
</body>
</html>
